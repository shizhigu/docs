---
title: Data Steward 架构
description: 内部开发笔记 - 简化版设计
---

<Warning>
这是内部开发笔记，不对外公开。
</Warning>

## 设计理念

**核心原则**：Less is more

Data Steward 的使命：
1. **学习** - 理解业务数据含义
2. **发现** - 找到有趣的模式/异常
3. **协作** - 与用户定义规则
4. **交接** - 触发 Analysis Agent 深入调查

**不做的事**：
- ❌ KPI 监控（用户有 dashboard）
- ❌ 数据质量检查（有专门工具）
- ❌ Schema 变更检测（data engineering 的活）
- ❌ 定时任务调度（ops 的活）

---

## 存储架构

**纯 Markdown，没有 SQLite。**

```
/data/memory/
├── understanding/           # 业务理解
│   └── {conn_id}.md
├── discoveries/             # 发现的东西
│   └── {timestamp}_{slug}.md
├── requests/                # 交给 Analysis Agent 的请求
│   └── {id}.md
├── briefings/               # 给用户的摘要
│   └── latest.md
├── docs/                    # Agent 指南
│   └── guide.md
└── rules.md                 # 用户定义的关注规则
```

---

## 文件格式

### `understanding/{conn_id}.md`

Agent 对数据源的理解：

```markdown
# orders_db

## Overview
电商订单数据，包含订单、用户、商品信息。

## Key Tables
- orders: 订单记录
- users: 用户信息
- products: 商品目录

## Key Fields
- orders.total_amount: 订单金额（含税）
- orders.status: PENDING → PAID → SHIPPED → COMPLETED

## Business Context (Confirmed)
- 大促后通常有 10-15% 自然回落
- 周末订单量比工作日高约 20%

## Open Questions
- discount_type 字段的含义？
```

### `discoveries/{timestamp}_{slug}.md`

发现的东西，用 frontmatter 标记状态：

```markdown
---
status: new
type: anomaly
connection_id: orders_db
---

# 11月收入下降 12%

## What I Found
11月收入 $125k，比10月 $142k 下降 12%。

## Evidence
- 订单量持平
- 客单价下降 10%
- 大单数量减少 42%

## Possible Explanations
1. 大促结束效应
2. B2B 订单减少
3. 季节性？

## Suggested Action
需要深入调查，已创建分析请求。
```

**Status**: `new` → `investigating` → `confirmed` → `dismissed`

### `rules.md`

用户定义的关注规则：

```markdown
# Watch Rules

## Active Rules
- [ ] 日收入下降超过 15%
- [ ] 订单取消率超过 5%
- [ ] 出现异常大单（>$10,000）

## Recently Triggered
- [x] 收入下降 → discoveries/2024-01-15_revenue_drop.md
```

### `requests/{id}.md`

交给 Analysis Agent 的请求：

```markdown
---
status: pending
discovery: 2024-01-15_revenue_drop
---

# 调查11月收入下降

## Question
11月收入下降 12%，为什么？是问题还是正常现象？

## Context
见 discoveries/2024-01-15_revenue_drop.md

## For Analysis Agent
1. 是否季节性模式？
2. 什么导致客单价下降？
3. 为什么大单减少？

## Result
（Analysis Agent 完成后填写）
```

---

## Agent 工作流程

```
读取现有知识 (understanding/)
        ↓
探索数据 (sample, query)
        ↓
检查用户规则 (rules.md)
        ↓
发现有趣的东西？
        ↓ Yes
写入 discoveries/
        ↓
需要深入调查？
        ↓ Yes
创建 requests/
        ↓
更新 briefings/latest.md
        ↓
继续探索...
```

---

## 消息系统

只有两种消息：

1. **初始消息** - 首次启动时
2. **继续消息** - 之后一直发 "Continue"

Agent 自己决定做什么，不需要复杂的消息编排。

---

## 与 Analysis Agent 的交接

```
Continuous Learning Agent          Analysis Agent
        │                               │
        │  发现异常                      │
        │      ↓                        │
        │  创建 requests/{id}.md        │
        │      ↓                        │
        │  (status: pending)            │
        │      ↓                        │
        └──────────────────────────────→│
                                        │
                                   读取请求
                                        │
                                   深入调查
                                        │
                                   填写 Result
                                        │
                                   更新 status
```

---

## 代码位置

| 组件 | 文件 |
|------|------|
| Agent 指南 | `prompts_steward.py` → `GUIDE` |
| 继续消息 | `prompts_steward.py` → `CONTINUE_MESSAGE` |
| 初始消息 | `prompts_steward.py` → `build_initial_message()` |
| 目录初始化 | `modal/agent.py` → `_init_memory_structure()` |
| 指南写入 | `modal/agent.py` → `_init_guide()` |

---

## 为什么这样设计？

| 选择 | 原因 |
|------|------|
| 纯 Markdown | Agent 自然读写，人类方便检查 |
| 没有 SQLite | 不需要复杂查询，避免双存 |
| 没有任务调度 | Agent 自己决定做什么 |
| 只有一种消息 | 简单，智能在 Agent 侧 |
| 聚焦发现 | 这是我们的差异化价值 |

---

## 差异化定位

| 现有工具 | 做什么 | SkoutLab |
|---------|-------|----------|
| Dashboard | 展示你定义的指标 | 发现你没想到的指标 |
| 监控告警 | 基于规则触发 | 自动学习什么是异常 |
| BI 工具 | 回答已知问题 | 发现未知问题 |

**SkoutLab 的定位**：发现你不知道要问的问题。
